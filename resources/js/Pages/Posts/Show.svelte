<script context="module">
    export { default as layout } from "@/Layouts/App.svelte";
</script>

<script>
    import { page, Link, useForm } from "@inertiajs/svelte";
		import NavList from '@/Components/NavList.svelte';
		import NavLink from '@/Components/NavLink.svelte';
		import Panel from '@/Components/Panel.svelte';
		import Fa from "svelte-fa";
    import { faPencil, faTrash } from "@fortawesome/free-solid-svg-icons";

    export let posts;
    export let post;
    let dialog;
    let form = useForm();

    function destroy() {
        dialog.showModal();
    }

    function submit() {
        $form.delete(`/posts/${post.id}`);
    }
</script>

<svelte:head>
    <title>{post.title}</title>
</svelte:head>

<div class="flex">

	<Panel heading="Posts">
		{#if posts.data && posts.data.length != 0 }
			<NavList>
				<NavLink href="/posts/create">New Post</NavLink>
				{#each posts.data as post}
					<NavLink href="/posts/{post.id}">{post.title}</NavLink>
				{/each}
			</NavList>
		{/if}
	</Panel>

	<article class="p-4">
			<div class="flex justify-between items-center border-b border-base-300 pb-3 mb-3">
					<div class="title font-bold">{post.title}</div>

					{#if $page.props.auth.user}
							<div class="inline-flex items-center gap-3">
									<Link href="/posts/{post.id}/edit" title="Edit Post" class="text-gray-500"><Fa icon={faPencil} /></Link>
									<button title="Delete Post" class="text-gray-500" on:click={() => destroy()}><Fa icon={faTrash} /></button>
							</div>
					{/if}
			</div>

			<div class="content prose max-w-none mb-3">
					{@html post.content_to_html}
			</div>
	</article>

</div>

<dialog bind:this={dialog} class="modal">
    <form on:submit|preventDefault={submit} class="modal-box">
        <h3 class="font-bold text-lg">Confirm</h3>
        <p class="py-4">Delete this post?</p>

        <div class="modal-action">
            <button class="btn btn-neutral btn-sm" on:click|preventDefault={() => dialog.close()}>No</button>
            <button type="submit" class="btn btn-error btn-sm">Yes</button>
        </div>
    </form>
</dialog>